<html>
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha1.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"> </script>
</head>
<body>
  <div class="col-md-8 col-md-offset-2">
    <h2>Welcome to the Super Awesome Internet Enabled Coffee Maker&trade; Control Panel</h2>
    <p>Most coffee varieties can be brewed on the spot, but some of the more popular varieties require a 15 character employee password to brew. Your order will be submited into a processing queue and should be ready for pickup within 5 minutes. </p>
  </div>
  <div class="col-md-4 col-md-offset-2">
    <h3>Brew a Normal Coffee</h3>
    <form id="unauth" class="form-inline">
      <select id="unauthed-select" class="form-control">
        <option value="latte">Latte</option>
        <option value ="americano">Americano</option>
        <option value ="mocha">Mocha</option>
      </select>
      <button type="submit" class="btn btn-default">Submit</button>
    </form>
    <br>
    <h3>Brew a Restricted Coffee</h3>
    <form id="auth" class="form-inline">
      <div id="passsword-group" class="form-group">
        <label id="password-label" class="control-label" for="password"></label>
        <input id="password" class="form-control" type="text" maxlength="15" placeholder="Password"/>
      </div>
      <select id="authed-select" class="form-control">
        <option value="espresso">Espresso</option>
        <option value="cappuccino">Cappuccino</option>
      </select>
      <div class="form-group">
        <button type="submit" class="btn btn-default">Submit</button>
      </div>
    </form>
  </div>
  <script>
    $('#unauth').submit(function (evt) {
      evt.preventDefault();
      hashes = {
        "latte":"c037b03d65549eaf05607832dae18f26c602d583",
        "americano":"5e3ece3a886d5ff19ca157b9f79180f8759f524b",
        "mocha":"85a3db488dfed277198a8c031db5e6ad865d4637"
      };
      var select = document.getElementById("unauthed-select");
      var type = select.options[select.selectedIndex].value;
      window.location = './brew.php' + '?type=' + type + '&auth=' + hashes[type];
    });
    $('#auth').submit(function (evt) {
      evt.preventDefault();
      var select = document.getElementById("authed-select");
      var type = select.options[select.selectedIndex].value;
      var password = document.getElementById("password").value;
      //Hash is generated from password + URI
      var hash = CryptoJS.SHA1(password + '/brew.php?type='+type);
      //Make sure password is correct length
      if (password.length == 15){
        window.location = './brew.php' + '?type=' + type + '&auth=' + hash;
      }
      else{
        var group = document.getElementById("passsword-group");
        group.classList.add('has-error');
        group.classList.add('has-feedback');
        document.getElementById("password-label").innerHTML = "Password must be 15 characters long";
      }
    });
  </script>
</body>

</html>
